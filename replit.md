# Replit Agent Guide

## Overview

This is a **crypto sportsbook affiliate/review website** called "Bet Without KYC." It's a full-stack web application that showcases and ranks cryptocurrency betting platforms (bookmakers), displays bonus offers, and publishes blog content. The site earns revenue through affiliate links to various crypto sportsbooks.

The app follows a monorepo structure with a React frontend, Express backend, and PostgreSQL database using Drizzle ORM.

## User Preferences

Preferred communication style: Simple, everyday language.

## System Architecture

### Project Structure
```
client/          → React frontend (Vite-powered SPA)
server/          → Express backend API
shared/          → Shared types and database schema (Drizzle ORM)
migrations/      → Database migrations (generated by Drizzle Kit)
attached_assets/ → Static assets
script/          → Build scripts
```

### Frontend
- **Framework**: React with TypeScript
- **Build Tool**: Vite
- **Styling**: Tailwind CSS with CSS custom properties for theming (supports dark mode via class strategy)
- **UI Components**: shadcn/ui pattern (component library using Radix primitives + Tailwind)
- **Path Aliases**: `@` → `client/src`, `@shared` → `shared/`, `@assets` → `attached_assets/`
- **Routing**: SPA with client-side routing (server falls through to index.html for all non-API routes)

### Backend
- **Framework**: Express.js on Node.js
- **API Pattern**: RESTful JSON API under `/api/` prefix
- **Authentication**: Simple admin auth using `x-admin-key` header matched against `SESSION_SECRET` env var, plus referer-based checks for same-origin requests
- **Content Security**: HTML sanitization via `sanitize-html` for blog post content
- **Dev Server**: Vite dev server middleware integrated with Express for HMR in development
- **Production**: Static file serving from `dist/public`

### Database
- **Database**: PostgreSQL (required, connection via `DATABASE_URL` env var)
- **ORM**: Drizzle ORM with `drizzle-orm/node-postgres` driver
- **Schema Location**: `shared/schema.ts` — single source of truth for both backend and frontend types
- **Migrations**: Managed by Drizzle Kit, output to `migrations/` directory
- **Connection**: Uses `pg.Pool` for connection pooling
- **Seeding**: Automatic seed on startup if bookmakers table is empty (`server/seed.ts`)

### Core Data Models
1. **Users** — Basic username/password accounts (UUID primary keys)
2. **Bookmakers** — Crypto sportsbook listings with ratings, rankings, affiliate URLs, pros/cons, supported cryptos, and sports
3. **Bonuses** — Bonus offers tied to bookmakers (welcome bonuses, etc.)
4. **Blog Posts** — Content marketing articles with publish status
5. **Affiliate Clicks** — Tracking clicks on affiliate links per bookmaker

### Storage Layer
- `server/storage.ts` defines an `IStorage` interface and `DatabaseStorage` implementation
- All database access goes through the storage abstraction, making it possible to swap implementations
- Queries use Drizzle's query builder with operators like `eq`, `desc`, `asc`, `ilike`

### Build System
- **Client Build**: Vite builds to `dist/public`
- **Server Build**: esbuild bundles server code to `dist/`, with an allowlist of dependencies to bundle (reduces cold start syscalls) and the rest treated as externals
- **Build Script**: `script/build.ts` orchestrates both builds sequentially

### Key Design Decisions
- **Shared Schema**: The Drizzle schema in `shared/schema.ts` is imported by both client and server, ensuring type safety across the stack. Insert schemas are generated via `drizzle-zod` for validation.
- **UUID Primary Keys**: All tables use `gen_random_uuid()` for ID generation at the database level.
- **Array Columns**: PostgreSQL text arrays are used for multi-value fields (cryptos accepted, sports covered, pros, cons) rather than separate join tables — simpler for a content-focused site.
- **Admin Auth**: Lightweight header-based auth rather than a full session/JWT system — appropriate for a single-admin content site.
- **Raw Body Capture**: Express JSON middleware captures `rawBody` on requests (likely for Stripe webhook signature verification, given Stripe is in build dependencies).

## External Dependencies

### Required Services
- **PostgreSQL Database**: Primary data store, connected via `DATABASE_URL` environment variable. Must be provisioned before the app can start.

### Environment Variables
- `DATABASE_URL` — PostgreSQL connection string (required)
- `SESSION_SECRET` — Used as the admin API key for protected routes

### Notable NPM Dependencies (from build allowlist)
- **drizzle-orm / drizzle-zod** — ORM and schema validation
- **pg** — PostgreSQL client
- **express / express-session / express-rate-limit** — Server framework and middleware
- **stripe** — Payment processing (likely for premium features or subscriptions)
- **openai / @google/generative-ai** — AI integrations (possibly for content generation)
- **nodemailer** — Email sending
- **passport / passport-local** — Authentication framework
- **sanitize-html** — HTML sanitization for user-generated content
- **multer** — File upload handling
- **xlsx** — Spreadsheet processing
- **nanoid / uuid** — ID generation
- **ws** — WebSocket support
- **jsonwebtoken** — JWT token handling